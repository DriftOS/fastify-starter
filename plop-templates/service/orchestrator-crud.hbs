import { BaseOrchestrator, DefaultPerformanceTracker } from '@core/orchestration/index.js';
import type { PipelineStage } from '@core/orchestration/index.js';
import type {
  {{pascalCase name}}PipelineContext,
  Create{{pascalCase name}}Input,
  {{pascalCase name}}
} from './types/index.js';
import * as ops from './operations/index.js';

/**
 * {{pascalCase name}} Orchestrator (CRUD)
 *
 * Implements the Golden Orchestrator pattern for {{pascalCase name}} operations.
 *
 * Generated by: npm run generate
 */
export class Create{{pascalCase name}}Orchestrator extends BaseOrchestrator<
  {{pascalCase name}}PipelineContext,
  {{pascalCase name}},
  Create{{pascalCase name}}Input
> {
  constructor() {
    super({
      name: 'Create{{pascalCase name}}Orchestrator',
      timeout: 5000,
      enableMetrics: true,
      logErrors: true,
    });
  }

  protected async initializeContext(
    input: Create{{pascalCase name}}Input
  ): Promise<{{pascalCase name}}PipelineContext> {
    return {
      requestId: Math.random().toString(36).substr(2, 9),
      startTime: Date.now(),
      perfTracker: new DefaultPerformanceTracker(),
      input,
      results: {},
      errors: [],
      metadata: {
        orchestrator: this.getName(),
        inputType: 'Create{{pascalCase name}}Input',
      },
    };
  }

  protected getPipeline(): PipelineStage<{{pascalCase name}}PipelineContext>[] {
    return [
      {{#each operations}}
      {
        name: '{{kebabCase this}}',
        operation: ops.{{camelCase this}},
        critical: true,
        timeout: 2000,
      },
      {{/each}}
    ];
  }

  protected buildResult(context: {{pascalCase name}}PipelineContext): {{pascalCase name}} {
    if (!context.{{camelCase name}}) {
      throw new Error('{{pascalCase name}} creation failed - no {{camelCase name}} in context');
    }
    return context.{{camelCase name}};
  }
}
